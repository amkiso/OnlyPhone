<!doctype html>
<html lang="vi">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>@ViewBag.Title - Admin Panel</title>
    <link href="~/Content/Bootstrap/bootstrap.min.css" rel="stylesheet" />
    <link href="~/Content/FontAwesome/css/all.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <link href="~/Content/Css/adminlayout.css" rel="stylesheet" />

</head>
<body>
    <aside class="sidebar" aria-label="Sidebar">
        <div class="brand">
            
            <span>Bảng điều khiển</span>
            <button id="sidebarCollapseBtn" class="sidebar-collapse-btn" aria-label="Thu gọn thanh điều hướng" title="Thu gọn/Hiện" style="display:none">
                <i class="fa fa-chevron-left"></i>
            </button>
        </div>

        <nav role="navigation" aria-label="Main navigation">
            <a href="@Url.Action("Dashbroad", "Home")" class="nav-item @(ViewContext.RouteData.Values["controller"].ToString() == "Dashboard" ? "active" : "")">
                <div class="nav-icon"><i class="fa fa-tachometer-alt" aria-hidden="true"></i></div>
                <div>Dashboard</div>
            </a>
            <a href="@Url.Action("Index", "Users")" class="nav-item">
                <div class="nav-icon"><i class="fa fa-user" aria-hidden="true"></i></div>
                <div>Tài khoản</div>
            </a>
            <a href="@Url.Action("Revenue", "Stats")" class="nav-item">
                <div class="nav-icon"><i class="fa fa-chart-line" aria-hidden="true"></i></div>
                <div>Doanh thu</div>
            </a>
            <a href="@Url.Action("Index", "Orders")" class="nav-item">
                <div class="nav-icon"><i class="fa fa-shopping-bag" aria-hidden="true"></i></div>
                <div>Đơn hàng</div>
            </a>
            <a href="@Url.Action("Manager", "Product")" class="nav-item">
                <div class="nav-icon"><i class="fa fa-box-open" aria-hidden="true"></i></div>
                <div>Sản phẩm</div>
            </a>
            <a href="@Url.Action("Index", "Products")" class="nav-item">
                <div class="nav-icon"><i class="fa fa-tags" aria-hidden="true"></i></div>
                <div>Nhãn hàng</div>
            </a>
            <a href="@Url.Action("Index", "Products")" class="nav-item">
                <div class="nav-icon"><i class="fa fa-mobile-phone" aria-hidden="true"></i></div>
                <div>Dòng điện thoại</div>
            </a>
            <a href="@Url.Action("Index", "Products")" class="nav-item">
                <div class="nav-icon"><i class="fa fa-bell" aria-hidden="true"></i></div>
                <div>Thông báo</div>
            </a>
            <a href="@Url.Action("Index", "Products")" class="nav-item">
                <div class="nav-icon"><i class="fa fa-ticket" aria-hidden="true"></i></div>
                <div>Voucher</div>
            </a>
            <a href="@Url.Action("Index", "Home", new { area =""})" class="nav-item">
                <div class="nav-icon"><i class="fa fa-house" aria-hidden="true"></i></div>
                <div>Trang chủ</div>
            </a>
            <a href="@Url.Action("Logout", "Account", new { area =""})" class="nav-item">
                <div class="nav-icon"><i class="fa fa-sign-out" aria-hidden="true"></i></div>
                <div>Đăng xuất</div>
            </a>
        </nav>

        <div style="margin-top:auto;color:var(--muted);font-size:13px">
            Phiên bản: <strong>1.0</strong>
        </div>
    </aside>

    <main class="main">
        <header class="header">
            <div>
                <div class="welcome">Xin chào ! Admin</div>
                <div class="sub-muted">Quản trị hệ thống • @ViewBag.Title</div>
            </div>

            <div class="header-right">
                <div class="theme-toggle" title="Chuyển đổi giao diện">
                    <div style="font-size:13px;color:var(--muted)">Giao diện</div>
                    <div class="toggle-btn" id="themeToggle" role="button" aria-pressed="false" tabindex="0">
                        <div class="toggle-knob"></div>
                    </div>
                </div>

                <div style="display:flex;flex-direction:column;align-items:flex-end;">
                    <div style="font-size:13px;color:var(--muted)">Xin chào !</div>
                    <div style="font-weight:700;color:var(--text)">Admin</div>
                </div>

                <div class="avatar" title="Admin">A</div>
            </div>
        </header>

        @RenderBody()

        <footer style="margin-top:18px;color:var(--muted);font-size:13px">© 2025 Công ty bạn</footer>
    </main>

    <div id="sidebarOverlay" aria-hidden="true"></div>

    <script>
        (function () {
            function createToggle() {
                const header = document.querySelector('.header');
                if (!header || document.getElementById('sidebarToggle')) return;
                const btn = document.createElement('button');
                btn.id = 'sidebarToggle';
                btn.type = 'button';
                btn.className = 'sidebar-toggle';
                btn.setAttribute('aria-label', 'Toggle navigation');
                btn.innerHTML = '<i class="fa fa-bars" aria-hidden="true"></i>';
                header.insertBefore(btn, header.firstChild);
                btn.addEventListener('click', () => {
                    document.body.classList.toggle('sidebar-collapsed');
                    updateOverlay();
                    const sbtn = document.getElementById('sidebarCollapseBtn');
                    if (sbtn) {
                        const ic = sbtn.querySelector('i');
                        ic.className = document.body.classList.contains('sidebar-collapsed') ? 'fa fa-chevron-right' : 'fa fa-chevron-left';
                    }
                });
            }
            function handleInitialCollapse() {
                if (window.innerWidth < parseInt(getComputedStyle(document.documentElement).getPropertyValue('--mobile-break'))) {
                    document.body.classList.add('sidebar-collapsed');
                } else {
                    document.body.classList.remove('sidebar-collapsed');
                }
                updateOverlay();
            }
            function ensureOverlay() {
                let o = document.getElementById('sidebarOverlay');
                if (!o) {
                    o = document.createElement('div'); o.id = 'sidebarOverlay';
                    document.body.appendChild(o);
                    o.addEventListener('click', () => { document.body.classList.add('sidebar-collapsed'); updateOverlay(); });
                }
                return o;
            }
            function updateOverlay() {
                const overlay = ensureOverlay();
                const isMobile = window.innerWidth < parseInt(getComputedStyle(document.documentElement).getPropertyValue('--mobile-break'));
                if (isMobile && !document.body.classList.contains('sidebar-collapsed')) {
                    overlay.classList.add('visible');
                } else {
                    overlay.classList.remove('visible');
                }
            }
            document.addEventListener('DOMContentLoaded', () => {
                createToggle(); handleInitialCollapse(); window.addEventListener('resize', handleInitialCollapse);
                document.querySelectorAll('.nav-item').forEach(el => {
                    el.addEventListener('click', () => {
                        if (window.innerWidth < parseInt(getComputedStyle(document.documentElement).getPropertyValue('--mobile-break'))) {
                            document.body.classList.add('sidebar-collapsed'); updateOverlay();
                        }
                    });
                });
                const sidebar = document.querySelector('.sidebar');
                if (sidebar && !document.getElementById('sidebarCollapseBtn')) {
                    const brand = sidebar.querySelector('.brand');
                    const btn = document.createElement('button');
                    btn.id = 'sidebarCollapseBtn'; btn.className = 'sidebar-collapse-btn';
                    btn.innerHTML = '<i class="fa fa-chevron-left" aria-hidden="true"></i>';
                    brand.appendChild(btn);
                    btn.addEventListener('click', () => {
                        document.body.classList.toggle('sidebar-collapsed'); updateOverlay();
                        const ic = btn.querySelector('i');
                        ic.className = document.body.classList.contains('sidebar-collapsed') ? 'fa fa-chevron-right' : 'fa fa-chevron-left';
                    });
                }
            });
        })();

        // Theme Toggle Logic
        (function () {
            const body = document.body;
            const toggle = document.getElementById('themeToggle');
            const saved = localStorage.getItem('theme');
            if (saved === 'dark') body.classList.add('dark');
            function setTheme(isDark) {
                if (isDark) body.classList.add('dark'); else body.classList.remove('dark');
                localStorage.setItem('theme', isDark ? 'dark' : 'light');
                window.dispatchEvent(new Event('themeChanged'));
            }
            if (toggle) toggle.addEventListener('click', () => setTheme(!body.classList.contains('dark')));
        })();
    </script>

    @RenderSection("Scripts", required: false)
</body>
</html>